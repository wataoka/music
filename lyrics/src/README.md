# 歌詞生成AI
--- 

　**AIに歌詞を作らせたい！**その一心でこのプロジェクトは動き出しました。制作期間だいたい3ヶ月。本や記事や論文を読み漁り、開発していく日々はまさに学びの喜びそのものでした。皆さんもぜひ歌詞生成AIを動かして遊ぶだけでなく、内部の理論を理解し、その美しさに感動して見て下さい。至らぬ点も多々あると思いますが頑張って作りましたので、是非この解説記事を楽しんでお読み下さい。

※ この記事は一般向けに作成しました。機械学習を専門とする方には少し満足感の欠けるものかもしれません。

## 手法
---

 1. データセットを準備する。
 2. 歌詞を単語ごとに切り分ける。
 3. 単語に番号を割り振る。
 4. 番号を用いてAIに学習させる。
 5. 学習済みAIに例文を渡し、次の単語を予想させる。
 6. 5を繰り返す。
 
さてさて、いきなり全体像をお見せしました。機械学習に精通していらっしゃる方ならすぐに理解していただけるかと思いますが、専門外の方はどうでしょうか。早くも置いて行かれそうな気がしたでしょうか。ご心配なく、頑張って説明します。。。

### 1. データセットを準備する。

　データセットの準備には割と時間がかかりました。何しろ欲しいものは歌詞です。著作物です。どのサイトもタダで提供してくれるはずがなく、ずいぶん四苦八苦しました。ウェブサイトからスクレイピングしました。スクレイピングというものはウェブサイトから情報を抽出する技術のことです。要するにプログラミングの力で歌詞の収集を自動化させたということです。今回は下記のサイトを参考にして、歌詞TIMEというサイトから6万曲ほどの歌詞を収集しました。

- Rubyを使って歌詞サイトから歌詞を取得する方法
http://geektrainee.hatenablog.jp/entry/2014/07/15/105134

### 2. 歌詞を単語ごとに切り分ける

　英語の文章では単語ごとにスペースで区切られているのですが、日本語では違います。うまく単語ごとに切り分けることを分かち書きと言います。日本語で分かち書きをするにはMeCabというツールを使います。MeCabは京都大学情報学研究科のプロジェクトを通じて開発された無料で使えるエンジンです。これを使うことで、ただ単語を分かち書きするだけでなく、それぞれの品詞や活用形までも解析することができます。

### 3. 単語に番号を割り振る
　歌詞をコンピュータに学習させる訳ですから、当然数字に変換する必要があります。割り振り方は至って単純。順番に読み取った単語に1, 2, 3, ...と数字を割り振っていきます。この時、プログラム内できっちりと数字と単語の対応関係を記録していきます。例えば、1ならば「私」。42ならば「山」。24552ならば「走る」。というように大量に対応関係をとっていきます。下に実際のコードを記載しておきます。

```python
    word2index = dict((c, i) for i, c in enumerate(word_set))
    index2word = dict((i, c) for i, c in enumerate(word_set))
```

ここで定義された`word2index`に単語を渡すと数字を返し、`index2word`に数字を渡すと単語を返します。このようにして単語と数字の対応関係を保存しておくのです。

※ `word_set`という変数には読み込んだ大量の単語が重複なく格納されています。

### 4. 番号を用いてAIに学習させる
　さて、この解説記事の肝です。大量の歌詞を単語に切り分け、それらを数字にしましたが、どのようにして学習するのでしょうか。ここではLSTM(Long Short Term Memory)というシステムを使用しました。LSTMとは下の図のような形をしています。

![LSTM](http://corochann.com/wp-content/uploads/2017/05/rnn1_expand.png)

　難しそうですね...。ざっくりと説明しますと、このシステムは時系列データを学習するように設計されたものです。例えば、1, 2, 3, 4, 5と数字が続いた後に、どんな数字がくるでしょうか。皆さんは6だろうと簡単に正解にたどり着くことができるでしょう。しかしコンピュータにはそれは難問です。ですので、似たような問題と答えを大量に用意してあげることで、予想の精度を高めていくのです。

### 5. 学習済みAIに例文を渡し、次の単語を予想させる。
 皆さんは気づいたでしょうか。先ほどのシステムを用いることで歌詞生成を実現させることができることに。私たちは先ほど歌詞の単語を数字に変え、それを順番に保存していきました。なので、その順番を学習させることで「君」「が」の次の単語は「好き」じゃないか。というようなそれっぽい予想ができるようになるのです。


　より詳しくLSTMの理論を知りたい方は下のサイトがオススメです。

- LSTMネットワークの概要
https://qiita.com/KojiOhki/items/89cd7b69a8a6239d67ca

- 今更聞けないLSTMの基本
https://www.hellocybernetics.tech/entry/2017/05/06/182757

- わかるLSTM ～ 最近の動向と共に
https://qiita.com/t_Signull/items/21b82be280b46f467d1b


### 6. 5を繰り返す。
予想した単語を文章の続きとして見なし、またその続きを予想させることで歌詞生成を実現することができるのです。今回は全ての歌詞を学習させず、特定の歌手を学習させることにしました。(その方が世界観が統一され、歌詞っぽくなったからです。**筆者が様々な歌手を試し、出力された歌手を見ていきましょう。

## 結果
---

### 選択歌手：長渕剛  

学習1回目  
> ひとつを今夜に川の
> コップに笑い負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負け
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 自分た負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた自分た負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた負けた
> 負けた負けた負けた負けた負けた負けた負けた負けた負けた自分た負けた負けた負けた

学習3回目  
> ままから路地雨の中も
> 俺は俺の鹿児島は
> 今としたものを
> 人で行くのにとしたよ
> ものは僕は数えそう
> 俺の名は今お前を
> 俺は俺はもこんなととしたよ
> 人でもないで俺とも
> 人をしてた俺らも
> 私は俺の街を
> 朝にくると人に
> 負けたよか人でも
> 俺は俺は今と人は
> 今お前をしてた俺は
> 今あなたの前によ
> 俺は俺が今俺らは
> 今今俺が今だと人を
> 俺は俺は今お前と今たよ
> 人が俺がある俺は
> 今とした俺は

学習9回目  
> 少女たくし
> お前はこと人ためよ
> 好きな好きもね
> 好きてくれてもない俺らの
> 好き俺は最後だよ
> あなたよ機嫌をまでまで
> 終業はあんたの
> お前は抱きしめて行くわけを
> 好きだと思ったね
> 好き好き厚化粧だだ「するするに
> たくたく好きにだだから
> TouchTakeyourBACKで言わonyour海が抱き海が向こうか
> 俺はあんただとですを
> 風に何をてて
> 何何何に何も
> 度出がみよ「、優しでに
> 許してくれくれたお前は
> 好きに好きだだから
> 好きてきだよぜ

学習を重ねることで少しずつ文章っぽくなっていく。


### 選択歌手：Mr.Children  

学習回数12回目  
> 光まで愛してる僕は
> 君の僕はどう君の
> たい君に会いたい愛して
> 君にどうたい君の
> たい愛していた君に
> たい君に会いたい愛して
> 君に会いたい愛して
> 君にどう君に会いたい愛して
> 君に会いたい君に
> たい愛しています君は
> 君に会いたい愛して
> 君に会いたい愛して
> 君にどうたい君の
> たい君に会いたい愛して
> 君にどう君に会いたい君に
> たい愛しています君がどう
> 君に会いたい君に
> たい愛しています君がどう
> 君に会いたい君に
> たい愛しています君に

君会いたいしか言わなくなったのでミスチルは諦めました。

### 選択歌手：福山雅治

学習回数10回目  
> 風になるの日曜日君は
> ポケットのもの君のものだよ
> 素直になれない…そう
> 君と見たいいつもずっとさ
> 君のすべてみつめていつも愛に
> 希望のこの胸の中できっときっと夢は
> 前になれ言葉の明日の
> 僕は見ているの
> ものを君のように
> 俺道を太陽たらふたりの

これが最も出来が良かった歌詞です。


### 選択歌手：福山雅治+長渕剛

学習回数10回目

> 俺を俺は俺は
> 今までも行くそうそう
> 青春ね欲しい明日が笑ってねえ俺は
> 俺らの中になり生きて
> 二を待っになれの
> お前がこないでを
> 事にけれどと破片で俺らが
> お前はだけの中だけ
> Tomorrow明日明日と信じと信じて
> お前が時と思えん
> 愛を待ってたん
> 心をずっとその笑っを
> 涙の心になりて
> 頭ねお前のんだ笑って笑ってNeverそう
> 今は今あたいのいつもそう
> 真っ直ぐ真っ直ぐ真っ直ぐ真っ直ぐ真っ直ぐ生きて
> お前が好きだ嫌いと抱きしめそう
> 君ととひとり手の
> 女の俺は今でしょでしょ愛の
> !!KNOCK!KNOCK!

このように複数歌手の足し算できます。どことなく福山雅治の甘い歌詞と長渕剛の男らしい歌詞が混在している気がしませんか？
